<!DOCTYPE html>
<html>
    <head>
        <script src='/js/flag.js' ></script><!-- included for the awesome math seedrandom function-->
        <script src="map.js"></script>
        <script src="rhill-voronoi-core.js"></script>
        <script src="https://raw.github.com/jwagner/simplex-noise.js/master/simplex-noise.js"></script>
        <script>
            var seed=Number(getParameterByName('cityid'));
            if (seed <=0 || seed >=1000000 ){
                seed= Math.floor((Math.random()*1000000)+1); 
            }
            Math.seedrandom(seed);
            var width =600;
            var height=450;
            var sites=3000;
            var colorid=0;
            var map=new WorldMap(width,height,sites);

            window.onload = function(){
                document.getElementById("seedID").value=seed;
                var canvas = document.getElementById("worldmapCanvas1");
                canvas.height=height;canvas.width=width;
                map.paintBackground(canvas);

                for (var i=0; i < map.diagram.cells.length ; i++ ){
                    map.colorPolygon(i,canvas,document.getElementById("mode").value);
                }
                colorlegend();
            };
 
            function colorlegend(){
                for (terrain in map.terrain){
                    document.getElementById(terrain).style.background = map.getTerrainColor(terrain);
                }
            } 
            function clickie(){
                var canvas = document.getElementById("worldmapCanvas1");
                for (var i=0; colorid<map.diagram.cells.length && i < 50 ; i++ ){
                    map.colorPolygon(colorid,canvas,'highlight','#0FF');
                    var cell=map.diagram.cells[colorid];
                    colorid++;
                }
            }
 
 
            function getParameterByName(name){
                name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
                var regexS = "[\\?&]" + name + "=([^&#]*)";
                var regex = new RegExp(regexS);
                var results = regex.exec(window.location.search);
                if(results == null)
                    return "";
                else
                    return decodeURIComponent(results[1].replace(/\+/g, " "));
            }


            function changeMode(mode){
                var canvas = document.getElementById("worldmapCanvas1");
                map.paintBackground(canvas);
                for (var i=0; i < map.diagram.cells.length ; i++ ){
                    map.colorPolygon(i,canvas,mode);
                }
            }


            function examineCell(){
                var cellid = document.getElementById("cellid").value;
                var canvas = document.getElementById("worldmapCanvas1");
                var cell   = map.diagram.cells[cellid];
                map.paintBackground(canvas);
                for (var i=0; i < map.diagram.cells.length ; i++ ){
                    map.colorPolygon(i,canvas,document.getElementById("mode").value);
                }
                //map.render(canvas);
                map.colorPolygon(cellid,canvas,'highlight','#0FF');
                document.getElementById('celldetails').value="CellID: "      + cell.site.voronoiId+" "+
                                                             "  x,y: "       + cell.site.x+","+cell.site.y+" "+
                                                             "  elevation: " + cell.elevation+"\n"+
                                                             "  moisture: " + cell.moisture+"   "+
                                                             "  radius: "    + cell.radius+"\n"+
                                                             "  color: "     + cell.color+"   "+
                                                             "  border: "     + cell.border+"   "+
                                                             "  ocean: "     + cell.ocean+"\n"+
                                                             "  debug: "     + cell.debug+"\n";



            }
        </script>
        <title> CityGenerator's Worldmap</title>
    </head>
    <body>
        <canvas id="worldmapCanvas1"  style="border:1px solid black;float:left;" ></canvas>

        <div>
            cityid: <input type='text' id='seedID' />
            mode:
                <select id='mode' onchange='changeMode(this.value)'>
                    <option>biomes</option>
                    <option>moisture</option>
                    <option>land elevation</option>
                    <option>land/shallows</option>
                    <option>elevation</option>
                    <option>land/ocean</option>
                    <option>land elevation</option>
                </select>
        </div>
        <div>
            Examine Cell: 
                <input type='button' value='<<' onclick='document.getElementById("cellid").value--;examineCell();'>
                <input type='text' id='cellid' value='962'/>
                <input type='button' value='examine' onclick='examineCell();'>
                <input type='button' value='>>' onclick='document.getElementById("cellid").value++;examineCell();'><br>

                <input type='button' value='950' onclick='document.getElementById("cellid").value=this.value;examineCell();'>
                <input type='button' value='962' onclick='document.getElementById("cellid").value=this.value;examineCell();'>
                <input type='button' value='992' onclick='document.getElementById("cellid").value=this.value;examineCell();'>
                <input type='button' value='1007' onclick='document.getElementById("cellid").value=this.value;examineCell();'>
                <textarea id='celldetails'  rows="12" cols="70">cell info</textarea>

        </div>
<div>
<span id='Bare'> Bare</span>
<span id='Grassland'> Grassland</span>
<span id='Scorched'> Scorched</span>
<span id='Shrubland'> Shrubland</span>
<span id='Snow'> Snow</span>
<span id='Subtropical Desert'> Subtropical Desert</span>
<span id='Taiga'> Taiga</span>
<span id='Temperate Deciduous Forest'> Temperate Deciduous Forest</span>
<span id='Temperate Desert'> Temperate Desert</span>
<span id='Temperate Rain Forest'> Temperate Rain Forest</span>
<span id='Tropical Rain Forest'> Tropical Rain Forest</span>
<span id='Tropical Seasonal Forest'> Tropical Seasonal Forest</span>
<span id='Tundra'> Tundra</span>


</div>

    </body>
</html>

