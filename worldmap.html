<!DOCTYPE html>
<html>
    <head>
        <script src='js/flag.js' ></script><!-- included for the awesome math seedrandom function-->
        <script src="js/map.js"></script>
        <script src="js/rhill-voronoi-core.js"></script>
        <script src="js/simplex-noise.js"></script>
        <script>
            window.seed=Number(getParameterByName('cityid'));
            if (window.seed <=0 || window.seed >=1000000 ){
                window.seed= Math.floor((Math.random()*1000000)+1); 
            }
            Math.seedrandom(window.seed);
            var width =450;
            var height=300;
            var sites=3000;
            var map=new WorldMap(width,height,sites);

            window.onload = function(){
                document.getElementById("seedID").value=window.seed;
                var canvas = document.getElementById("worldmapCanvas1");
                canvas.height=height;canvas.width=width;
                map.paintBackground(canvas);

                for (var i=0; i < map.diagram.cells.length ; i++ ){
                    map.colorPolygon(map.diagram.cells[i],canvas,document.getElementById("mode").value);
                }
                colorlegend();

                map.drawRivers(canvas);
                var continentseed=window.seed - window.seed%10;
                map.designateKingdoms(continentseed,canvas);
                map.boxKingdoms();

//                map.render(canvas);

                var box=map.kingdoms[1].box;
                map.drawbox(box,canvas,'rgba(255,0,255,1)')

//                map.drawbox(box,canvas,'rgba(255,200,0,1)')



//                var canvas = document.getElementById("region");
//                canvas.height=height;canvas.width=width;
//                map.paintBackground(canvas);
//                map.drawRegion(canvas,1);
//
////                map.drawRivers(canvas);
////                map.render(canvas);

            };
 
            function colorlegend(){
                for (terrain in map.terrain){
                    document.getElementById(terrain).style.background = map.getTerrainColor(terrain);
                }
            } 
 
            function getParameterByName(name){
                name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
                var regexS = "[\\?&]" + name + "=([^&#]*)";
                var regex = new RegExp(regexS);
                var results = regex.exec(window.location.search);
                if(results == null)
                    return "";
                else
                    return decodeURIComponent(results[1].replace(/\+/g, " "));
            }


            function changeMode(){
                var canvas = document.getElementById("worldmapCanvas1");
                var mode = document.getElementById("mode").value;
                map.paintBackground(canvas);
                for (var i=0; i < map.diagram.cells.length ; i++ ){
                    map.colorPolygon(map.diagram.cells[i],canvas,mode);
                }
            }
            function drawCorners(){
                var cellid = document.getElementById("cellid").value;
                var canvas = document.getElementById("worldmapCanvas1");
                //changeMode();
                for (var i=0; i < map.diagram.cells.length ; i++ ){
                    var cell=map.diagram.cells[i];
                    for (var j=0; j < cell.corners.length ; j++ ){
                        var corner=cell.corners[j];
                        map.colorCorner(corner,canvas,mode);
                    }
                }
                
            }

            function locateRegion(){
                Math.seedrandom(window.seed);
                var cellid = document.getElementById("cellid").value;
                var canvas = document.getElementById("worldmapCanvas1");
                var cell   = map.diagram.cells[cellid];
                if (! cell.ocean){
                    var cells=map.getRegion(cell);
                    for (var i=0; i < cells.length ; i++ ){
                        map.colorPolygon(cells[i],canvas,mode,'#fd0a1d');
                    }
                }else{
                    alert("cell "+cellid+' is ocean, so no region for it!');
                }
            }
            
            function examineCell(){
                var cellid = document.getElementById("cellid").value;
                var canvas = document.getElementById("worldmapCanvas1");
                var cell   = map.diagram.cells[cellid];
                map.paintBackground(canvas);
                for (var i=0; i < map.diagram.cells.length ; i++ ){
                    map.colorPolygon(map.diagram.cells[i],canvas,document.getElementById("mode").value);
                }
                //map.render(canvas);
                map.colorPolygon(map.diagram.cells[cellid],canvas,'highlight','#0FF');
                document.getElementById('celldetails').value="CellID: "      + cell.site.voronoiId+" "+
                                                             "  elevation: " + cell.elevation+"\n"+
                                                             "  x,y: "       + cell.site.x+","+cell.site.y+" "+
                                                             "  moisture: " + cell.moisture+"   "+
                                                             "  radius: "    + cell.radius+"\n"+
                                                             "  color: "     + cell.color+"   "+
                                                             "  border: "     + cell.border+"   "+
                                                             "  ocean: "     + cell.ocean+""+
                                                             "  coast: "     + cell.coast+"\n"+
                                                             "----------------------------------\n"+
                                                             "  corners: "     + JSON.stringify(cell.corners)+"\n";

            }
        </script>
        <title> CityGenerator's Worldmap</title>
    </head>
    <body>
        <canvas id="worldmapCanvas1"  style="border:1px solid black;float:left;" ></canvas>
        <canvas id="region"  style="border:1px solid black;float:left;" ></canvas>

        <div>
            cityid: <input type='text' id='seedID' />
            mode:
                <select id='mode' onchange='changeMode()'>
                    <option>biomes</option>
                    <option>elevation</option>
                    <option>land elevation</option>
                    <option>moisture</option>
                </select>
        </div>
        <div>
            Examine Cell: 
                <input type='button' value='<<' onclick='document.getElementById("cellid").value--;examineCell();'/>
                <input type='text' id='cellid' value='962'/>
                <input type='button' value='examine' onclick='examineCell();'/>
                <input type='button' value='>>' onclick='document.getElementById("cellid").value++;examineCell();'/>
                <input type='button' value='downslopes' onclick='map.drawDownslopes(document.getElementById("worldmapCanvas1"));'  />
                <input type='button' value='rivers' onclick='map.drawRivers(document.getElementById("worldmapCanvas1"));'  />
                <input type='button' value='show kingdoms' onclick='map.drawKingdoms();'  />

                <input type='button' value='colorCorners' onclick='drawCorners();'  /><br>

                <input type='button' value='950' onclick='document.getElementById("cellid").value=this.value;examineCell();'/>
                <input type='button' value='962' onclick='document.getElementById("cellid").value=this.value;examineCell();'/>
                <input type='button' value='992' onclick='document.getElementById("cellid").value=this.value;examineCell();'/>
                <input type='button' value='1007' onclick='document.getElementById("cellid").value=this.value;examineCell();'/>
                <textarea id='celldetails'  rows="12" cols="70">cell info</textarea>

        </div>
<div>
<span id='Bare'> Bare</span>
<span id='Grassland'> Grassland</span>
<span id='Scorched'> Scorched</span>
<span id='Shrubland'> Shrubland</span>
<span id='Snow'> Snow</span>
<span id='Subtropical Desert'> Subtropical Desert</span>
<span id='Taiga'> Taiga</span>
<span id='Temperate Deciduous Forest'> Temperate Deciduous Forest</span>
<span id='Temperate Desert'> Temperate Desert</span>
<span id='Temperate Rain Forest'> Temperate Rain Forest</span>
<span id='Tropical Rain Forest'> Tropical Rain Forest</span>
<span id='Tropical Seasonal Forest'> Tropical Seasonal Forest</span>
<span id='Tundra'> Tundra</span>


</div>

    </body>
</html>

